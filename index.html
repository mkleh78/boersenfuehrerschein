<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Börsen-Quiz für Teens | Teste dein Wissen!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-dark: #0f0f23;
      --bg-card: #1a1a2e;
      --primary: #7c3aed;
      --primary-hover: #6d28d9;
      --accent: #10b981;
      --accent-red: #ef4444;
      --text-primary: #f3f4f6;
      --text-secondary: #9ca3af;
      --border: #374151;
      --gold: #fbbf24;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      background-image: radial-gradient(circle at 20% 50%, rgba(124,58,237,.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(16,185,129,.1) 0%, transparent 50%);
    }
    #quiz-container {
      background: var(--bg-card);
      border-radius: 24px;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04);
      width: 100%;
      max-width: 900px;
      overflow: hidden;
      border: 1px solid var(--border);
      position: relative;
    }
    /* Start Screen */
    #start-screen { padding: 3rem; text-align: center; min-height: 500px; display: flex; flex-direction: column; justify-content: center; }
    .emoji-header { font-size: 4rem; margin-bottom: 1.5rem; animation: bounce 2s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; background: linear-gradient(135deg,var(--primary) 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6; }
    .start-btn { background: linear-gradient(135deg,var(--primary) 0%, var(--primary-hover) 100%); color: #fff; font-size: 1.25rem; font-weight: 600; padding: 1rem 3rem; border: none; border-radius: 12px; cursor: pointer; transition: all .3s ease; box-shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -1px rgba(0,0,0,.06); margin: 2rem auto 0; }
    .start-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05); }
    /* Header */
    #quiz-header { padding: 2rem 2rem 1.5rem; border-bottom: 1px solid var(--border); display: none; }
    .header-content { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .level-badge { background: rgba(124,58,237,.2); color: var(--primary); padding: .5rem 1rem; border-radius: 20px; font-weight: 600; font-size: .875rem; }
    .streak-counter { display: flex; align-items: center; gap: .5rem; font-weight: 600; }
    .streak-fire { font-size: 1.5rem; }
    /* Progress */
    #progress-container { margin-bottom: 1.5rem; }
    #question-counter { font-size: .875rem; color: var(--text-secondary); margin-bottom: .5rem; }
    #progress-bar-container { background: var(--border); height: 8px; border-radius: 999px; overflow: hidden; position: relative; }
    #progress-bar { background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%); height: 100%; transition: width .5s ease; box-shadow: 0 0 10px rgba(124,58,237,.5); }
    /* Question Area */
    #question-area { padding: 2rem; display: none; }
    #question-text { font-size: 1.5rem; font-weight: 600; margin-bottom: 2rem; line-height: 1.4; min-height: 3em; }
    .difficulty-indicator { display: inline-flex; gap: .25rem; margin-bottom: 1rem; }
    .difficulty-star { color: var(--gold); font-size: 1rem; }
    /* Options */
    .options-grid { display: grid; gap: 1rem; }
    .option-btn { background: rgba(255,255,255,.05); border: 2px solid var(--border); color: var(--text-primary); padding: 1.25rem; border-radius: 12px; cursor: pointer; transition: all .2s ease; text-align: left; font-size: 1.1rem; font-weight: 500; position: relative; overflow: hidden; }
    .option-btn:hover:not(:disabled) { border-color: var(--primary); background: rgba(124,58,237,.1); transform: translateX(4px); }
    .option-btn:disabled { cursor: not-allowed; opacity: .8; }
    .option-btn.correct { border-color: var(--accent); background: rgba(16,185,129,.2); animation: correctPulse .6s ease; }
    .option-btn.incorrect { border-color: var(--accent-red); background: rgba(239,68,68,.1); animation: shake .5s ease; }
    @keyframes correctPulse { 0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)} }
    @keyframes shake { 0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)} }
    /* Feedback */
    #feedback-text { margin-top: 1.5rem; padding: 1rem 1.5rem; border-radius: 12px; display: none; font-size: 1rem; line-height: 1.6; animation: slideIn .3s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    #feedback-text.correct { background: rgba(16,185,129,.1); border: 1px solid var(--accent); color: var(--text-primary); }
    #feedback-text.incorrect { background: rgba(239,68,68,.1); border: 1px solid var(--accent-red); color: var(--text-primary); }
    .feedback-emoji { font-size: 1.5rem; margin-right: .5rem; }
    /* Navigation */
    #navigation { padding: 1.5rem 2rem; text-align: right; display: none; min-height: 80px; }
    #next-btn { background: linear-gradient(135deg,var(--primary) 0%, var(--primary-hover) 100%); color: #fff; font-size: 1.1rem; font-weight: 600; padding: .75rem 2rem; border: none; border-radius: 12px; cursor: pointer; transition: all .3s ease; display: none; }
    #next-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,.1); }
    /* Results */
    #results-screen { padding: 3rem; text-align: center; display: none; }
    .results-emoji { font-size: 5rem; margin-bottom: 1.5rem; }
    #results-screen h2 { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; }
    .score-circle { width: 200px; height: 200px; margin: 2rem auto; position: relative; }
    .score-circle svg { transform: rotate(-90deg); }
    .score-circle-bg { stroke: var(--border); stroke-width: 8; fill: none; }
    .score-circle-progress { stroke: url(#gradient); stroke-width: 8; fill: none; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
    #score-percentage { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; font-weight: 800; }
    .verdict-box { background: rgba(255,255,255,.05); border: 2px solid var(--border); border-radius: 16px; padding: 2rem; margin: 2rem 0; }
    .verdict-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
    .verdict-text { font-size: 1.1rem; line-height: 1.6; color: var(--text-secondary); }
    /* Topic Results */
    .topic-results { text-align: left; margin-top: 3rem; }
    .topic-results h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; text-align: center; }
    .topic-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
    .topic-card { background: rgba(255,255,255,.05); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; transition: all .2s ease; }
    .topic-card:hover { transform: translateY(-2px); border-color: var(--primary); }
    .topic-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .75rem; }
    .topic-name { font-weight: 600; font-size: .95rem; }
    .topic-score { font-weight: 500; color: var(--text-secondary); font-size: .875rem; }
    .topic-progress-bar-container { background: var(--border); height: 6px; border-radius: 999px; overflow: hidden; }
    .topic-progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%); transition: width .8s ease; }
    /* Buttons */
    .action-buttons { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; }
    .btn-secondary { background: transparent; border: 2px solid var(--primary); color: var(--primary); font-size: 1.1rem; font-weight: 600; padding: .75rem 2rem; border-radius: 12px; cursor: pointer; transition: all .3s ease; }
    .btn-secondary:hover { background: var(--primary); color: #fff; }
    /* Responsive */
    @media (max-width: 768px) {
      #quiz-container { border-radius: 0; border: none; min-height: 100vh; }
      h1 { font-size: 2rem; }
      #question-text { font-size: 1.25rem; }
      .score-circle { width: 150px; height: 150px; }
      #score-percentage { font-size: 2.5rem; }
      .topic-grid { grid-template-columns: 1fr; }
    }
    /* Achievement */
    .achievement-popup { position: fixed; top: 2rem; right: 2rem; background: var(--bg-card); border: 2px solid var(--gold); border-radius: 12px; padding: 1rem 1.5rem; display: none; align-items: center; animation: achievementSlide .5s ease; z-index: 1000; box-shadow: 0 10px 20px rgba(0,0,0,.2); }
    @keyframes achievementSlide { from { transform: translateX(400px); } to { transform: translateX(0); } }
    .achievement-popup .emoji { font-size: 2rem; margin-right: .5rem; }
    .achievement-text { font-weight: 600; }
    /* Loading dots */
    .loading-dots { display: inline-flex; gap: .25rem; }
    .loading-dots span { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: loadingDot 1.4s infinite ease-in-out both; }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes loadingDot { 0%,80%,100% { transform: scale(0); opacity: .5; } 40% { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body>
  <div id="quiz-container">
    <div id="start-screen">
      <div class="emoji-header">📈💰🚀</div>
      <h1>Börsen-Quiz für Teens</h1>
      <p class="subtitle">Bist du bereit, dein erstes Geld an der Börse zu investieren?<br />Teste dein Wissen und finde es heraus!</p>
      <button class="start-btn" onclick="startQuiz()">Let's go! 🎯</button>
    </div>

    <div id="quiz-header">
      <div class="header-content">
        <div class="level-badge" id="level-badge">Level: Börsen-Rookie</div>
        <div class="streak-counter"><span class="streak-fire">🔥</span><span id="streak-count">0</span></div>
      </div>
      <div id="progress-container">
        <div id="question-counter"></div>
        <div id="progress-bar-container"><div id="progress-bar"></div></div>
      </div>
    </div>

    <div id="question-area">
      <div class="difficulty-indicator" id="difficulty-stars"></div>
      <div id="question-text">
        <div class="loading-dots"><span></span><span></span><span></span></div>
      </div>
      <div class="options-grid" id="options-container"></div>
      <div id="feedback-text"></div>
    </div>

    <div id="navigation"><button id="next-btn" onclick="nextQuestion()">Weiter →</button></div>

    <div id="results-screen">
      <div class="results-emoji" id="results-emoji"></div>
      <h2>Quiz abgeschlossen!</h2>
      <div class="score-circle">
        <svg width="200" height="200" viewbox="0 0 200 200">
          <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#7c3aed;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
            </linearGradient>
          </defs>
          <circle cx="100" cy="100" r="90" class="score-circle-bg"></circle>
          <circle cx="100" cy="100" r="90" class="score-circle-progress" id="score-circle-progress"></circle>
        </svg>
        <div id="score-percentage">0%</div>
      </div>
      <div class="verdict-box">
        <div class="verdict-title" id="verdict-title"></div>
        <div class="verdict-text" id="verdict-text"></div>
      </div>
      <div class="topic-results">
        <h3>Deine Stärken und Schwächen</h3>
        <div class="topic-grid" id="topic-results-container"></div>
      </div>
      <div class="action-buttons">
        <button class="btn-secondary" onclick="startQuiz()">Nochmal versuchen</button>
        <button class="start-btn" onclick="shareResults()">Ergebnis teilen 📱</button>
      </div>
    </div>
  </div>

  <div class="achievement-popup" id="achievement-popup">
    <span class="emoji" id="achievement-emoji"></span>
    <span class="achievement-text" id="achievement-text"></span>
  </div>

  <script>
    // Quiz Data
    const quizTopics = {
      "Basics 🎯": [
        { q: "Was ist eine Aktie eigentlich?", a: [
          { text: "Ein kleiner Teil einer Firma, den du kaufen kannst", correct: true, explain: "Genau! Mit einer Aktie besitzt du tatsächlich ein winziges Stück vom Unternehmen. Cool, oder?" },
          { text: "Ein Gutschein für Produkte der Firma", correct: false, explain: "Nein, das wäre ein Rabattcoupon. Eine Aktie macht dich zum Mini-Besitzer der Firma!" },
          { text: "Ein Kredit, den du der Firma gibst", correct: false, explain: "Das wäre eine Anleihe. Bei Aktien bist du Miteigentümer, nicht Kreditgeber." },
          { text: "Eine Art Lottoschein", correct: false, explain: "Aktien sind kein Glücksspiel! Der Wert hängt davon ab, wie gut die Firma läuft." }
        ], difficulty: 1 },
        { q: "Was ist die Börse? Stell es dir vor wie...", a: [
          { text: "Ein riesiger Marktplatz, wo Leute Firmenanteile kaufen und verkaufen", correct: true, explain: "Perfekt! Die Börse ist wie eBay für Firmenanteile - nur viel größer und professioneller." },
          { text: "Eine Bank, wo man Geld leiht", correct: false, explain: "Nein, das ist eine normale Bank. An der Börse werden Aktien gehandelt." },
          { text: "Ein Laden, wo man Aktien druckt", correct: false, explain: "Aktien sind heute digital. Niemand druckt mehr Papier-Aktien." },
          { text: "Ein Casino für Reiche", correct: false, explain: "Falsch! Die Börse ist kein Casino. Hier geht's um echte Firmen mit echten Produkten." }
        ], difficulty: 1 },
        { q: "Wer bestimmt, wie viel eine Aktie kostet?", a: [
          { text: "Alle Käufer und Verkäufer zusammen durch Angebot und Nachfrage", correct: true, explain: "Richtig! Wenn viele kaufen wollen, steigt der Preis. Wenn viele verkaufen wollen, fällt er." },
          { text: "Der Chef der Firma", correct: false, explain: "Nein, der CEO kann den Preis nicht festlegen. Das macht der Markt." },
          { text: "Die Regierung", correct: false, explain: "Zum Glück nicht! In einer freien Wirtschaft bestimmt der Markt die Preise." },
          { text: "Ein Computer-Algorithmus bei Google", correct: false, explain: "Nein, obwohl Computer beim Handel helfen. Der Preis entsteht durch echte Kauf- und Verkaufsentscheidungen." }
        ], difficulty: 2 },
        { q: "Was ist ein Depot?", a: [
          { text: "Dein digitaler Tresor für Aktien und ETFs", correct: true, explain: "Genau! Im Depot werden deine gekauften Wertpapiere sicher aufbewahrt - alles digital." },
          { text: "Ein spezielles Sparkonto mit hohen Zinsen", correct: false, explain: "Nein, im Depot liegen Aktien, kein Bargeld. Und die können im Wert schwanken!" },
          { text: "Ein Schließfach bei der Bank", correct: false, explain: "Fast! Aber ein Depot ist digital, nicht physisch." },
          { text: "Eine App zum Aktien gucken", correct: false, explain: "Eine App zeigt dir dein Depot, aber das Depot selbst ist der Aufbewahrungsort." }
        ], difficulty: 1 },
        { q: "Was macht ein Broker für dich?", a: [
          { text: "Er führt deine Kauf- und Verkaufsaufträge an der Börse aus", correct: true, explain: "Richtig! Der Broker ist wie dein Zugang zur Börse. Ohne ihn kommst du da nicht rein." },
          { text: "Er sagt dir, welche Aktien du kaufen sollst", correct: false, explain: "Nein, das wäre ein Anlageberater. Die meisten Broker führen nur aus, was du willst." },
          { text: "Er verdoppelt dein Geld", correct: false, explain: "Schön wär's! Niemand kann das garantieren." },
          { text: "Er druckt neue Aktien", correct: false, explain: "Nein, Broker handeln nur mit existierenden Aktien." }
        ], difficulty: 2 },
        { q: "Du willst bei Trade Republic ein Depot eröffnen. Was brauchst du dafür als 14-Jähriger?", a: [
          { text: "Die Erlaubnis und Unterschrift deiner Eltern", correct: true, explain: "Korrekt! Unter 18 brauchst du immer die Zustimmung deiner Eltern für ein Depot." },
          { text: "Mindestens 1000€ Startkapital", correct: false, explain: "Falsch! Bei vielen Brokern kannst du schon mit 1€ anfangen." },
          { text: "Einen Börsenführerschein", correct: false, explain: "Den gibt's nicht! Aber dieses Quiz ist fast so gut 😉" },
          { text: "Gar nichts, einfach App runterladen", correct: false, explain: "So einfach ist es leider nicht. Minderjährige brauchen immer die Eltern." }
        ], difficulty: 1 },
        { q: "Was bedeutet 'Portfolio'?", a: [
          { text: "Alle deine Aktien, ETFs und anderen Investments zusammen", correct: true, explain: "Genau! Dein Portfolio ist deine gesamte Sammlung an Investments." },
          { text: "Eine teure Aktentasche", correct: false, explain: "Haha, nein! Obwohl das Wort tatsächlich 'Brieftasche' bedeutet." },
          { text: "Die beste Aktie, die du hast", correct: false, explain: "Nein, das wäre nur ein Teil deines Portfolios." },
          { text: "Ein Foto von deinem Depot", correct: false, explain: "Kreativ gedacht, aber nein! 😄" }
        ], difficulty: 1 },
        { q: "Was ist der Unterschied zwischen Zocken und Investieren?", a: [
          { text: "Investieren ist langfristig und durchdacht, Zocken ist kurzfristig und riskant", correct: true, explain: "Perfekt! Investoren denken in Jahren, Zocker in Stunden oder Tagen." },
          { text: "Gibt keinen, ist beides dasselbe", correct: false, explain: "Großer Fehler! Investieren basiert auf Analyse, Zocken auf Hoffnung." },
          { text: "Zocken ist billiger", correct: false, explain: "Im Gegenteil! Häufiges Handeln kostet viele Gebühren." },
          { text: "Investieren ist nur was für Alte", correct: false, explain: "Quatsch! Je früher du anfängst, desto besser. Zeit ist dein größter Vorteil!" }
        ], difficulty: 2 },
        { q: "Warum solltest du NIEMALS mit geliehenem Geld investieren?", a: [
          { text: "Weil du die Schulden zurückzahlen musst, auch wenn du Verluste machst", correct: true, explain: "Exakt! Stell dir vor, du verlierst 50% und musst trotzdem 100% plus Zinsen zurückzahlen. Autsch!" },
          { text: "Weil das illegal ist", correct: false, explain: "Es ist nicht illegal, aber extrem dumm und gefährlich." },
          { text: "Weil Banken das nicht erlauben", correct: false, explain: "Manche Banken bieten sogar Wertpapierkredite an. Finger weg davon!" },
          { text: "Weil man dann keine Dividende bekommt", correct: false, explain: "Das stimmt nicht, aber die Schulden sind das echte Problem." }
        ], difficulty: 3 }
      ],
      "Praxis & Tools 🛠️": [
        { q: "Was ist eine 'Limit-Order'?", a: [
          { text: "Du legst fest, zu welchem Preis maximal gekauft/minimal verkauft wird", correct: true, explain: "Genau! Mit Limit-Orders kontrollierst du den Preis. Sehr wichtig bei volatilen Aktien!" },
          { text: "Eine Order mit begrenzter Gültigkeit", correct: false, explain: "Das kann man einstellen, aber Limit bezieht sich auf den Preis." },
          { text: "Du darfst nur begrenzt viele Aktien kaufen", correct: false, explain: "Nein, es geht um den Preis, nicht die Menge." },
          { text: "Eine Order nur für Profis", correct: false, explain: "Jeder sollte Limit-Orders nutzen! Schützt vor bösen Überraschungen." }
        ], difficulty: 2 },
        { q: "Was kostet es ungefähr, wenn du für 100€ Aktien kaufst?", a: [
          { text: "Bei Neo-Brokern oft 0-1€, bei Banken 5-10€", correct: true, explain: "Richtig! Trade Republic & Co. sind viel günstiger als klassische Banken." },
          { text: "Immer genau 10%", correct: false, explain: "Nein, Gebühren sind meist fix oder minimal." },
          { text: "Nichts, Aktienhandel ist kostenlos", correct: false, explain: "Fast kostenlos bei manchen, aber nie ganz umsonst." },
          { text: "50€ Mindestgebühr", correct: false, explain: "Viel zu hoch! Solche Broker solltest du meiden." }
        ], difficulty: 2 },
        { q: "Was ist der 'Spread' und warum kostet er dich Geld?", a: [
          { text: "Differenz zwischen Kauf- und Verkaufspreis - du zahlst immer den schlechteren", correct: true, explain: "Genau! Kaufen zum Ask (teurer), verkaufen zum Bid (billiger). Die Differenz ist wie eine versteckte Gebühr." },
          { text: "Eine Extra-Gebühr vom Broker", correct: false, explain: "Nein, der Spread entsteht am Markt, nicht beim Broker." },
          { text: "Englisch für 'Aufstrich'", correct: false, explain: "Haha, aber hier geht's um Finanzen, nicht ums Frühstück!" },
          { text: "Gibt es nur bei Optionsscheinen", correct: false, explain: "Nein, jede Aktie hat einen Spread." }
        ], difficulty: 2 },
        { q: "Welche Handelszeiten hat die deutsche Börse ungefähr?", a: [
          { text: "9:00 bis 17:30 Uhr an Wocchentagen", correct: true, explain: "Richtig! Xetra handelt von 9-17:30. Andere Börsen haben andere Zeiten." },
          { text: "24/7 wie Krypto", correct: false, explain: "Nein, Aktienbörsen haben feste Zeiten und sind am Wochenende zu." },
          { text: "Nur vormittags", correct: false, explain: "Nein, den ganzen Tag bis 17:30." },
          { text: "Immer wenn du willst", correct: false, explain: "Du kannst Orders platzieren, aber ausgeführt werden sie nur während der Handelszeiten." }
        ], difficulty: 2 },
        { q: "Stop-Loss-Order: Wofür ist die gut?", a: [
          { text: "Automatisch verkaufen wenn der Kurs unter ein Niveau fällt - begrenzt Verluste", correct: true, explain: "Genau! Wie eine Notbremse. Aber Vorsicht: Bei Gaps kann der Verkauf auch drunter liegen!" },
          { text: "Verhindert jeden Verlust", correct: false, explain: "Schön wär's! Begrenzt nur, verhindert nicht." },
          { text: "Stoppt den Handel komplett", correct: false, explain: "Nein, verkauft nur deine Position." },
          { text: "Nur für Daytrader", correct: false, explain: "Kann jeder nutzen, besonders bei riskanteren Positionen." }
        ], difficulty: 2 },
        { q: "Deine Aktie zahlt 3€ Dividende. Du hast 10 Aktien. Was passiert?", a: [
          { text: "30€ landen auf deinem Verrechnungskonto (minus Steuern)", correct: true, explain: "Richtig! 10 × 3€ = 30€ brutto. Netto bleiben nach Steuern etwa 22€." },
          { text: "Du bekommst 3€", correct: false, explain: "Nein, 3€ PRO Aktie, also 30€ bei 10 Stück!" },
          { text: "Die Aktie steigt um 3€", correct: false, explain: "Nein, sie fällt sogar meist um die Dividende am Ex-Tag." },
          { text: "Du musst 30€ zahlen", correct: false, explain: "Andersrum! Du bekommst Geld." }
        ], difficulty: 2 }
      ],
      "Produkte 📊": [
        { q: "Was ist ein ETF? Denk an einen Obstkorb...", a: [
          { text: "Statt einer Aktie kaufst du einen ganzen Korb voller verschiedener Aktien", correct: true, explain: "Perfekte Analogie! Ein ETF ist wie ein Obstkorb - du bekommst viele verschiedene 'Früchte' auf einmal." },
          { text: "Eine einzelne, besonders teure Aktie", correct: false, explain: "Nein, das Gegenteil! ETFs enthalten viele Aktien und sind oft günstiger." },
          { text: "Ein Sparvertrag mit festen Zinsen", correct: false, explain: "Nein, ETFs schwanken im Wert wie Aktien auch." },
          { text: "Eine Versicherung gegen Verluste", correct: false, explain: "Leider nein! ETFs können auch fallen, nur das Risiko ist besser verteilt." }
        ], difficulty: 1 },
        { q: "Der MSCI World ETF enthält Aktien aus wie vielen Ländern ungefähr?", a: [
          { text: "23 Industrieländer", correct: true, explain: "Richtig! Der MSCI World deckt die entwickelten Märkte ab, aber keine Schwellenländer." },
          { text: "Alle 195 Länder der Welt", correct: false, explain: "Nein, 'World' ist etwas irreführend. Schwellenländer fehlen." },
          { text: "Nur USA und Europa", correct: false, explain: "Mehr! Japan, Australien, Kanada und andere sind auch dabei." },
          { text: "Nur die G7-Staaten", correct: false, explain: "Viel mehr! 23 Länder insgesamt." }
        ], difficulty: 3 },
        { q: "Was ist eine Dividende? Stell dir vor, du besitzt einen kleinen Teil von Coca-Cola...", a: [
          { text: "Coca-Cola schüttet einen Teil des Gewinns an dich aus", correct: true, explain: "Genau! Als Miteigentümer bekommst du einen winzigen Teil vom Gewinn - das ist die Dividende." },
          { text: "Du bekommst jedes Jahr gratis Cola", correct: false, explain: "Haha, schön wär's! Du bekommst Geld, keine Produkte." },
          { text: "Der Preis deiner Aktie steigt automatisch", correct: false, explain: "Nein, die Dividende ist eine Zahlung zusätzlich zum Aktienkurs." },
          { text: "Du musst Geld an Coca-Cola zahlen", correct: false, explain: "Andersrum! Die Firma zahlt an dich." }
        ], difficulty: 1 },
        { q: "Ein 'thesaurierender' ETF... was macht der mit deinen Dividenden?", a: [
          { text: "Er investiert sie automatisch wieder, damit dein Geld schneller wächst", correct: true, explain: "Richtig! 'Thesaurierend' = automatisches Reinvestieren. Perfekt für langfristigen Vermögensaufbau!" },
          { text: "Er zahlt sie auf dein Konto aus", correct: false, explain: "Das macht ein 'ausschüttender' ETF, nicht ein thesaurierender." },
          { text: "Er spendet sie", correct: false, explain: "Nein, dein Geld bleibt dein Geld!" },
          { text: "Er versteckt sie vor dem Finanzamt", correct: false, explain: "Nein! Alles läuft legal. Du musst trotzdem Steuern zahlen." }
        ], difficulty: 2 },
        { q: "Was ist der DAX?", a: [
          { text: "Die 40 größten deutschen Unternehmen in einem Index", correct: true, explain: "Korrekt! Der DAX zeigt, wie es den größten deutschen Firmen geht." },
          { text: "Eine deutsche Bank", correct: false, explain: "Nein, der DAX ist ein Index, keine Bank." },
          { text: "Die Börse in Frankfurt", correct: false, explain: "Die Börse heißt 'Frankfurter Börse', der DAX ist nur eine Kennzahl dort." },
          { text: "Ein Tier im Börsen-Zoo", correct: false, explain: "Haha, nein! Obwohl es Bullen und Bären an der Börse gibt 🐂🐻" }
        ], difficulty: 1 },
        { q: "Apple, Microsoft, Amazon... in welchem Index findest du die alle?", a: [
          { text: "S&P 500 und NASDAQ-100", correct: true, explain: "Richtig! Diese Tech-Giganten sind in beiden großen US-Indizes." },
          { text: "DAX", correct: false, explain: "Nein, das sind amerikanische Firmen. Der DAX ist nur für deutsche." },
          { text: "Bitcoin-Index", correct: false, explain: "Bitcoin ist eine Kryptowährung, kein Aktienindex." },
          { text: "Euro Stoxx 50", correct: false, explain: "Nein, der ist für europäische Unternehmen." }
        ], difficulty: 2 },
        { q: "Was ist der Vorteil von ETFs gegenüber einzelnen Aktien?", a: [
          { text: "Das Risiko ist auf viele Firmen verteilt", correct: true, explain: "Genau! Wenn eine Firma pleite geht, tut's nicht so weh, weil du noch 500 andere im ETF hast." },
          { text: "ETFs können niemals fallen", correct: false, explain: "Falsch! ETFs können fallen, nur meist weniger stark als Einzelaktien." },
          { text: "Man wird damit schneller reich", correct: false, explain: "Nein, ETFs sind eher für geduldige Anleger." },
          { text: "ETFs sind kostenlos", correct: false, explain: "Fast! Sie sind günstig (oft 0,2% pro Jahr), aber nicht kostenlos." }
        ], difficulty: 2 },
        { q: "Was sind 'Small Caps'?", a: [
          { text: "Aktien von kleineren Unternehmen", correct: true, explain: "Richtig! 'Cap' kommt von Marktkapitalisierung. Small Caps = kleine Firmen." },
          { text: "Billige Aktien unter 1€", correct: false, explain: "Nein! Der Preis sagt nichts über die Größe der Firma." },
          { text: "Kleine Mützen für Trader", correct: false, explain: "Haha, netter Versuch! 😄" },
          { text: "Aktien, die man nur wenig kaufen darf", correct: false, explain: "Nein, du darfst so viele kaufen wie du willst (und bezahlen kannst)." }
        ], difficulty: 2 }
      ],
      "Markt & Preise 💹": [
        { q: "Die Inflation ist 5%. Was bedeutet das für dein Sparbuch mit 0,01% Zinsen?", a: [
          { text: "Dein Geld verliert real an Wert - du kannst dir weniger kaufen", correct: true, explain: "Exakt! Bei 5% Inflation und 0,01% Zinsen verlierst du jedes Jahr fast 5% Kaufkraft. Autsch!" },
          { text: "Super! Du bekommst 5% mehr Zinsen", correct: false, explain: "Nein, Inflation frisst dein Geld auf, sie gibt dir keins." },
          { text: "Egal, Geld ist Geld", correct: false, explain: "Falsch! 100€ heute kaufen mehr als 100€ nächstes Jahr." },
          { text: "Das Sparbuch wird teurer", correct: false, explain: "Nein, dein Geld darauf wird weniger wert." }
        ], difficulty: 2 },
        { q: "Was ist ein 'Bullenmarkt'? 🐂", a: [
          { text: "Die Kurse steigen über längere Zeit", correct: true, explain: "Richtig! Der Bulle stößt mit den Hörnern nach oben = steigende Kurse." },
          { text: "Die Kurse fallen stark", correct: false, explain: "Das wäre ein Bärenmarkt 🐻" },
          { text: "Nur Landwirtschafts-Aktien werden gehandelt", correct: false, explain: "Nein, hat nichts mit echten Bullen zu tun!" },
          { text: "Die Börse ist geschlossen", correct: false, explain: "Nein, die Börse läuft normal weiter." }
        ], difficulty: 1 },
        { q: "Die Zentralbank erhöht die Zinsen. Was passiert oft mit Aktien?", a: [
          { text: "Sie fallen, weil Sparen attraktiver wird", correct: true, explain: "Richtig! Höhere Zinsen = Festgeld wird attraktiver = Geld fließt aus Aktien ab." },
          { text: "Sie steigen immer", correct: false, explain: "Nein, meist das Gegenteil!" },
          { text: "Nichts, Zinsen sind egal", correct: false, explain: "Zinsen sind super wichtig für die Börse!" },
          { text: "Die Börse schließt", correct: false, explain: "Nein, sie bleibt offen." }
        ], difficulty: 2 },
        { q: "Was ist eine Rezession?", a: [
          { text: "Die Wirtschaft schrumpft - weniger Jobs, weniger Konsum", correct: true, explain: "Genau! In einer Rezession läuft die Wirtschaft rückwärts. Nicht gut für Aktien." },
          { text: "Alles wird billiger", correct: false, explain: "Nicht unbedingt! Manchmal gibt's sogar Inflation in der Rezession." },
          { text: "Die Börse macht Urlaub", correct: false, explain: "Nein, die Börse läuft weiter - meist mit fallenden Kursen." },
          { text: "Alle werden reich", correct: false, explain: "Das Gegenteil! Viele verlieren in Rezessionen Geld und Jobs." }
        ], difficulty: 2 },
        { q: "Tesla-Aktie steigt 20% an einem Tag! Was solltest du tun?", a: [
          { text: "Erstmal cool bleiben und überlegen, warum sie gestiegen ist", correct: true, explain: "Perfekt! FOMO (Fear of Missing Out) ist dein Feind. Erst denken, dann handeln." },
          { text: "SOFORT kaufen, bevor sie noch höher steigt!!!", correct: false, explain: "Klassischer Anfängerfehler! Nach 20% Plus ist das Risiko hoch." },
          { text: "All-in mit deinem ganzen Geld!", correct: false, explain: "Niemals! Besonders nicht nach so einem Anstieg." },
          { text: "Tesla shorten (auf fallende Kurse setzen)", correct: false, explain: "Viel zu riskant für Anfänger! Lass die Finger von Shorts." }
        ], difficulty: 2 },
        { q: "Was ist Volatilität?", a: [
          { text: "Wie stark eine Aktie rauf und runter schwankt", correct: true, explain: "Genau! Hohe Volatilität = wilde Achterbahnfahrt. Niedrige = ruhige Fahrt." },
          { text: "Ein italienisches Getränk", correct: false, explain: "Das wäre Vitality oder so 😄" },
          { text: "Wie viel Strom eine Aktie verbraucht", correct: false, explain: "Aktien verbrauchen keinen Strom (nur der Handel)." },
          { text: "Die Lautstärke an der Börse", correct: false, explain: "Nein, hat nichts mit Lärm zu tun." }
        ], difficulty: 2 },
        { q: "Was ist ein 'Börsencrash'?", a: [
            { text: "Ein extrem schneller, starker und breiter Kurseinbruch", correct: true, explain: "Genau! Ein Crash ist wie ein Erdbeben für die Börse - alles fällt gleichzeitig und sehr schnell." },
            { text: "Wenn die Börse für einen Tag schließt", correct: false, explain: "Die Börse kann den Handel aussetzen, aber das ist eine Folge des Crashs, nicht die Definition." },
            { text: "Wenn alle Aktien wertlos werden", correct: false, explain: "Nicht ganz, die Firmen existieren ja noch. Die Kurse erholen sich oft wieder, aber es kann dauern." },
            { text: "Ein geplanter Ausverkauf", correct: false, explain: "Crashes sind das Gegenteil von geplant - sie sind chaotisch und von Panik getrieben." }
        ], difficulty: 2}
      ],
      "Risiko & Sicherheit 🛡️": [
        { q: "Was bedeutet 'Diversifikation' oder 'Streuung'?", a: [
          { text: "Nicht alles auf eine Karte setzen, sondern in viele verschiedene Dinge investieren", correct: true, explain: "Genau! Wie bei Pokémon: Fang sie nicht alle von einem Typ, sondern mische dein Team. Das reduziert das Risiko." },
          { text: "Nur in eine einzige, sichere Aktie investieren", correct: false, explain: "Das Gegenteil! Das wäre maximale Konzentration und hohes Risiko." },
          { text: "Sein Geld auf verschiedene Banken verteilen", correct: false, explain: "Das ist auch klug, aber beim Investieren geht es um verschiedene Aktien, Branchen und Länder." },
          { text: "Nur an verschiedenen Wochentagen kaufen", correct: false, explain: "Das hat mit Diversifikation nichts zu tun." }
        ], difficulty: 2 },
        { q: "Was passiert mit deinen Aktien, wenn dein Broker (z.B. Trade Republic) pleite geht?", a: [
          { text: "Nichts! Deine Aktien sind Sondervermögen und gehören dir, nicht dem Broker", correct: true, explain: "Richtig! Deine Aktien werden nur verwahrt. Sie gehören dir und können einfach auf ein neues Depot übertragen werden. Sicher!" },
          { text: "Alles ist weg, Pech gehabt", correct: false, explain: "Zum Glück nicht! Das ist ein wichtiger Schutz für Anleger in Deutschland." },
          { text: "Sie werden automatisch verkauft", correct: false, explain: "Nein, sie bleiben unangetastet in deinem Besitz." },
          { text: "Der Staat kauft deine Aktien", correct: false, explain: "Nein, sie bleiben dein Eigentum." }
        ], difficulty: 3 },
        { q: "Was bedeutet die 'TER' (Total Expense Ratio) bei einem ETF?", a: [
          { text: "Die jährlichen Gesamtkosten des ETFs in Prozent", correct: true, explain: "Korrekt! Die TER zeigt, wie viel Prozent deines Geldes pro Jahr für die Verwaltung des ETFs abgehen. Je niedriger, desto besser!" },
          { text: "Die erwartete Rendite", correct: false, explain: "Nein, TER sind Kosten, keine Gewinne." },
          { text: "Die Anzahl der Aktien im ETF", correct: false, explain: "Nein, das hat mit den Kosten nichts zu tun." },
          { text: "Eine Steuernummer", correct: false, explain: "Nein, 'TER' ist eine Abkürzung für die Kostenquote." }
        ], difficulty: 2 }
      ],
      "Strategie & Mindset 🧠": [
        { q: "Was ist der Zinseszinseffekt und warum ist er deine Superkraft?", a: [
          { text: "Deine Zinsen verdienen wieder Zinsen, was zu exponentiellem Wachstum führt", correct: true, explain: "Genau! Es ist wie ein Schneeball, der einen Berg runterrollt und immer größer wird. Je früher du anfängst, desto gewaltiger wird der Effekt." },
          { text: "Ein Rabatt auf Steuern", correct: false, explain: "Nein, der Zinseszinseffekt ist ein mathematisches Prinzip, kein Steuergesetz." },
          { text: "Dass du mehr Zinsen zahlen musst", correct: false, explain: "Nur wenn du Schulden hast! Beim Investieren arbeitet er FÜR dich." },
          { text: "Ein Effekt, der nur bei Sparbüchern wirkt", correct: false, explain: "Er wirkt überall, wo du Erträge (Zinsen, Dividenden) reinvestierst. Bei Aktien ist er besonders stark." }
        ], difficulty: 2 },
        { q: "'Time in the market beats timing the market'. Was heißt das?", a: [
          { text: "Langfristig investiert zu sein ist wichtiger, als den perfekten Kaufzeitpunkt zu finden", correct: true, explain: "Absolut! Selbst Profis schaffen es nicht, den Markt zu 'timen'. Sei einfach dabei, das ist die beste Strategie." },
          { text: "Man sollte schnell kaufen und verkaufen", correct: false, explain: "Das Gegenteil! Das ist 'Market Timing' und scheitert meistens." },
          { text: "Man muss den Markt genau beobachten und timen", correct: false, explain: "Das ist ein Mythos. Langfristig dabei sein schlägt Hin und Her." },
          { text: "Investieren ist wie eine Eieruhr", correct: false, explain: "Haha, nein. Es geht darum, dass die investierte Zeit entscheidend ist, nicht das Timing." }
        ], difficulty: 3 },
        { q: "Was ist der Cost-Average-Effekt (Durchschnittskosteneffekt)?", a: [
          { text: "Bei Sparplänen kaufst du bei hohen Kursen weniger, bei tiefen Kursen mehr Anteile", correct: true, explain: "Genau! Wenn du immer für 50€ kaufst, bekommst du bei fallenden Kursen automatisch mehr Anteile für dein Geld. Das glättet deinen Einstiegspreis." },
          { text: "Dass die Kosten immer gleich bleiben", correct: false, explain: "Nein, es geht um den Durchschnitts-Einkaufspreis deiner Anteile." },
          { text: "Eine Strategie, um Kosten zu sparen", correct: false, explain: "Nicht direkt Kosten, sondern es optimiert den Einkaufspreis über die Zeit." },
          { text: "Dass man nur durchschnittliche Rendite erzielt", correct: false, explain: "Nein, es ist eine Methode, um das Risiko von schlechtem Timing zu reduzieren." }
        ], difficulty: 2 },
        { q: "Was ist die 'Buy and Hold'-Strategie?", a: [
          { text: "Wertpapiere kaufen und sie sehr lange (Jahre/Jahrzehnte) halten", correct: true, explain: "Korrekt. Das ist die entspannteste und für die meisten erfolgreichste Strategie. Kaufen, liegen lassen, reich werden (hoffentlich)." },
          { text: "Kaufen und sofort wieder verkaufen", correct: false, explain: "Das ist Daytrading, das Gegenteil von Buy and Hold." },
          { text: "Nur Aktien kaufen, die gerade im Trend sind", correct: false, explain: "Nein, Buy and Hold setzt auf die langfristige Entwicklung guter Unternehmen." },
          { text: "Immer wieder die gleichen Aktien kaufen", correct: false, explain: "Das kann Teil davon sein (Sparplan), aber der Kern ist das lange Halten." }
        ], difficulty: 1 }
      ]
    };

    // DOM Elements
    const quizContainer = document.getElementById('quiz-container');
    const startScreen = document.getElementById('start-screen');
    const quizHeader = document.getElementById('quiz-header');
    const questionArea = document.getElementById('question-area');
    const navigation = document.getElementById('navigation');
    const resultsScreen = document.getElementById('results-screen');
    const questionCounterEl = document.getElementById('question-counter');
    const progressBar = document.getElementById('progress-bar');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedbackTextEl = document.getElementById('feedback-text');
    const nextBtn = document.getElementById('next-btn');
    const streakCountEl = document.getElementById('streak-count');
    const levelBadge = document.getElementById('level-badge');
    const difficultyStarsEl = document.getElementById('difficulty-stars');
    const achievementPopup = document.getElementById('achievement-popup');
    const achievementEmoji = document.getElementById('achievement-emoji');
    const achievementText = document.getElementById('achievement-text');

    // Quiz State
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let streak = 0;
    let userAnswers = [];
    let achievementsUnlocked = new Set();


    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
    
    function flattenAndPrepareQuestions() {
        const allQuestions = [];
        for (const topic in quizTopics) {
            quizTopics[topic].forEach(q => {
                allQuestions.push({ ...q, topic: topic });
            });
        }
        return allQuestions;
    }

    function startQuiz() {
        // Reset state
        currentQuestionIndex = 0;
        score = 0;
        streak = 0;
        userAnswers = [];
        achievementsUnlocked.clear();

        // Prepare questions
        questions = flattenAndPrepareQuestions();
        shuffleArray(questions);
        
        // Update UI
        startScreen.style.display = 'none';
        resultsScreen.style.display = 'none';
        quizHeader.style.display = 'block';
        questionArea.style.display = 'block';
        navigation.style.display = 'block';
        
        loadQuestion();
    }

    function loadQuestion() {
        if (currentQuestionIndex < questions.length) {
            const question = questions[currentQuestionIndex];
            
            // Reset question area
            questionTextEl.innerHTML = '';
            optionsContainer.innerHTML = '';
            feedbackTextEl.style.display = 'none';
            nextBtn.style.display = 'none';
            
            // Loading indicator
            const loadingDots = `<div class="loading-dots"><span></span><span></span><span></span></div>`;
            questionTextEl.innerHTML = loadingDots;
            
            setTimeout(() => {
                // Update progress
                questionCounterEl.textContent = `Frage ${currentQuestionIndex + 1} von ${questions.length}`;
                progressBar.style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
                
                // Update header
                streakCountEl.textContent = streak;
                updateLevel();

                // Display difficulty
                difficultyStarsEl.innerHTML = '⭐️'.repeat(question.difficulty);

                // Display question
                questionTextEl.textContent = question.q;

                // Display options
                shuffleArray(question.a);
                question.a.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'option-btn';
                    button.innerHTML = option.text;
                    button.onclick = () => selectAnswer(button, option.correct, option.explain);
                    optionsContainer.appendChild(button);
                });
            }, 500); // Simulate loading

        } else {
            showResults();
        }
    }

    function selectAnswer(button, isCorrect, explanation) {
        // Disable all options
        const buttons = optionsContainer.querySelectorAll('.option-btn');
        buttons.forEach(btn => btn.disabled = true);

        const questionData = questions[currentQuestionIndex];
        userAnswers.push({
            question: questionData.q,
            topic: questionData.topic,
            correct: isCorrect
        });

        if (isCorrect) {
            button.classList.add('correct');
            score++;
            streak++;
            feedbackTextEl.innerHTML = `<span class="feedback-emoji">✅</span> <strong>Stark!</strong> ${explanation}`;
            feedbackTextEl.className = 'correct';
        } else {
            button.classList.add('incorrect');
            streak = 0;
            // Highlight the correct answer
            buttons.forEach((btn, index) => {
                if (questionData.a[index].correct) {
                    btn.classList.add('correct');
                }
            });
            feedbackTextEl.innerHTML = `<span class="feedback-emoji">🤔</span> <strong>Knapp daneben.</strong> ${explanation}`;
            feedbackTextEl.className = 'incorrect';
        }
        
        streakCountEl.textContent = streak;
        checkAchievements();

        feedbackTextEl.style.display = 'block';
        nextBtn.style.display = 'inline-block';
    }
    
    function nextQuestion() {
        currentQuestionIndex++;
        loadQuestion();
    }

    function updateLevel() {
        const progress = (currentQuestionIndex / questions.length) * 100;
        let level = "Börsen-Rookie";
        if (progress > 80) level = "Wall Street Wolf 🐺";
        else if (progress > 60) level = "Portfolio Pro 💼";
        else if (progress > 40) level = "Aktien-Azubi 📈";
        else if (progress > 20) level = "Depot-Entdecker 🧭";
        levelBadge.textContent = `Level: ${level}`;
    }

    function checkAchievements() {
      const achievements = [
        { id: 'streak3', condition: streak >= 3, emoji: '🔥', text: '3er-Serie!' },
        { id: 'streak5', condition: streak >= 5, emoji: '🚀', text: '5er-Serie!' },
        { id: 'streak10', condition: streak >= 10, emoji: '🤯', text: 'Mega-Serie!' },
        { id: 'firstCorrect', condition: score === 1 && currentQuestionIndex === 0, emoji: '🎯', text: 'Erster Treffer!' },
      ];

      achievements.forEach(ach => {
        if (ach.condition && !achievementsUnlocked.has(ach.id)) {
          showAchievement(ach.emoji, ach.text);
          achievementsUnlocked.add(ach.id);
        }
      });
    }

    function showAchievement(emoji, text) {
      achievementEmoji.textContent = emoji;
      achievementText.textContent = text;
      achievementPopup.style.display = 'flex';
      setTimeout(() => {
        achievementPopup.style.display = 'none';
      }, 3000);
    }

    function showResults() {
        // Hide quiz UI
        quizHeader.style.display = 'none';
        questionArea.style.display = 'none';
        navigation.style.display = 'none';

        const percentage = Math.round((score / questions.length) * 100);
        
        // Update score circle
        const scoreCircle = document.getElementById('score-circle-progress');
        const radius = scoreCircle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (percentage / 100) * circumference;
        
        scoreCircle.style.strokeDasharray = `${circumference} ${circumference}`;
        scoreCircle.style.strokeDashoffset = circumference;
        setTimeout(() => { // Animate the circle
            scoreCircle.style.strokeDashoffset = offset;
        }, 100);

        document.getElementById('score-percentage').textContent = `${percentage}%`;
        
        // Update verdict
        const resultsEmoji = document.getElementById('results-emoji');
        const verdictTitle = document.getElementById('verdict-title');
        const verdictText = document.getElementById('verdict-text');
        
        if (percentage >= 90) {
            resultsEmoji.textContent = '🏆';
            verdictTitle.textContent = 'Börsen-Legende!';
            verdictText.textContent = 'Wow! Du bist bereit für die Wall Street. Dein Wissen ist beeindruckend. Leg los, aber bleib demütig!';
        } else if (percentage >= 70) {
            resultsEmoji.textContent = '👍';
            verdictTitle.textContent = 'Sehr solide!';
            verdictText.textContent = 'Du hast eine starke Wissensbasis. Die wichtigsten Konzepte sitzen. Ein bisschen Feinschliff und du bist topfit.';
        } else if (percentage >= 50) {
            resultsEmoji.textContent = '🤔';
            verdictTitle.textContent = 'Guter Anfang!';
            verdictText.textContent = 'Du hast die Grundlagen drauf, aber es gibt noch Lücken. Schau dir deine schwächeren Themen nochmal an.';
        } else {
            resultsEmoji.textContent = '📚';
            verdictTitle.textContent = 'Da ist noch Luft nach oben';
            verdictText.textContent = 'Kein Meister ist vom Himmel gefallen. Nutze das Feedback, um die Grundlagen zu festigen. Wiederholen hilft!';
        }

        // Calculate and display topic results
        const topicScores = {};
        for (const topicName in quizTopics) {
            topicScores[topicName] = { correct: 0, total: 0 };
        }
        userAnswers.forEach(answer => {
            topicScores[answer.topic].total++;
            if (answer.correct) {
                topicScores[answer.topic].correct++;
            }
        });

        const topicResultsContainer = document.getElementById('topic-results-container');
        topicResultsContainer.innerHTML = '';
        for (const topicName in topicScores) {
            const data = topicScores[topicName];
            if (data.total > 0) {
                const topicPercentage = Math.round((data.correct / data.total) * 100);
                const card = document.createElement('div');
                card.className = 'topic-card';
                card.innerHTML = `
                    <div class="topic-header">
                        <span class="topic-name">${topicName}</span>
                        <span class="topic-score">${data.correct} / ${data.total}</span>
                    </div>
                    <div class="topic-progress-bar-container">
                        <div class="topic-progress-bar" style="width: 0%;"></div>
                    </div>
                `;
                topicResultsContainer.appendChild(card);
                // Animate progress bar
                setTimeout(() => {
                    card.querySelector('.topic-progress-bar').style.width = `${topicPercentage}%`;
                }, 200);
            }
        }
        
        resultsScreen.style.display = 'block';
    }

    async function shareResults() {
      const percentage = Math.round((score / questions.length) * 100);
      const shareText = `Ich habe im Börsen-Quiz für Teens ${percentage}% erreicht! 🚀 Teste auch du dein Wissen!`;
      const shareData = {
          title: 'Börsen-Quiz für Teens',
          text: shareText,
          url: window.location.href
      };

      try {
          if (navigator.share) {
              await navigator.share(shareData);
          } else {
              // Fallback for desktop/browsers without share API
              await navigator.clipboard.writeText(`${shareText} ${window.location.href}`);
              alert("Ergebnis in die Zwischenablage kopiert! Du kannst es jetzt teilen.");
          }
      } catch (err) {
          console.error("Fehler beim Teilen: ", err);
          alert("Teilen fehlgeschlagen. Du kannst den Link manuell kopieren.");
      }
    }
    
  </script>
</body>
</html>
